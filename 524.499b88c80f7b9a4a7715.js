(()=>{"use strict";const e="tt-media-progressive",t="tt-assets",n=("undefined"!=typeof window&&window.innerHeight,Math.round(425),new Set(["newMessage","newScheduledMessage","deleteMessages","deleteScheduledMessages","deleteHistory"]),new Set(["image/png","image/gif","image/jpeg"])),s=new Set(["video/mp4"]);new Set([...n,...s]),new Set(["AU","BD","CA","CO","EG","HN","IE","IN","JO","MX","MY","NI","NZ","PH","PK","SA","SV","US"]);const a=e=>new Promise((t=>{setTimeout((()=>t()),e)})),i=524288,o=new Map;async function r(e){const n=await async function(n,s){try{return await Promise.race([a(3e3).then((()=>Promise.reject(new Error("TIMEOUT")))),(async()=>{const n=await self.caches.open(t),s=await n.match(e.request);return{cache:n,cached:s}})()])}catch(e){return void console.error(e)}}(),{cache:s,cached:i}=n||{};if(s&&i){if(i.ok)return i;await s.delete(e.request)}const o=await fetch(e.request);return o.ok&&s&&s.put(e.request,o.clone()),o}var c;self.addEventListener("message",(e=>{const{type:t,messageId:n,result:s}=e.data;if("partResponse"===t){const e=o.get(n);e&&e.resolve(s)}})),function(e){e.True="1",e.False="0"}(c||(c={}));let d=(new Date).valueOf();const l=new Set,u={};function f(e){return e.custom.from_id?e.custom.from_id:e.custom.chat_id||e.custom.channel_id?`-${e.custom.chat_id||e.custom.channel_id}`:void 0}function g(e){if(e.custom.msg_id)return parseInt(e.custom.msg_id,10)}async function p(){const e=new URL(self.registration.scope).origin;return(await self.clients.matchAll({type:"window"})).filter((t=>new URL(t.url).origin===e))}async function w(e){const t=(await p())[0];t&&t.postMessage({type:"playNotificationSound",payload:{id:e}})}function h({chatId:e,messageId:t,body:n,title:s,icon:a}){const i=(new Date).valueOf()-d<1e3,o={body:n,data:{chatId:e,messageId:t,count:1},icon:a||"icon-192x192.png",badge:"icon-192x192.png",tag:String(i?0:e||0),vibrate:[200,100,200]};return Promise.all([w(String(t)||e||""),self.registration.showNotification(s,o)])}async function m(e,t){const{chatId:n,messageId:s}=t;if(n&&(e.postMessage({type:"focusMessage",payload:{chatId:n,messageId:s}}),!e.focused))try{await e.focus()}catch(e){console.warn("[SW] ",e)}}self.onsync=()=>{d=(new Date).valueOf()};const y=/[0-9a-f]{20}.*\.(js|css|woff2?|svg|png|jpg|jpeg|json|wasm)$/;self.addEventListener("install",(e=>{console.log("ServiceWorker installed"),e.waitUntil(self.skipWaiting())})),self.addEventListener("activate",(e=>{console.log("ServiceWorker activated"),e.waitUntil(Promise.race([a(3e3),Promise.all([self.caches.delete(t),self.clients.claim()])]))})),self.addEventListener("fetch",(t=>{const{url:n}=t.request;return n.includes("/progressive/")?(t.respondWith(async function(t){const{url:n}=t.request,s=t.request.headers.get("range"),r=/^bytes=(\d+)-(\d+)?$/g.exec(s||""),c=Number(r[1]),d=Number(r[2]);let l=d;if((!l||l-c+1>i)&&(l=c+i-1),0===c&&1===l){const e=t.request.url.match(/fileSize=(\d+)&mimeType=([\w/]+)/),n=e&&Number(e[1]),s=null==e?void 0:e[2];if(n&&s)return new Response(new Uint8Array(2).buffer,{status:206,statusText:"Partial Content",headers:[["Content-Range",`bytes 0-1/${n}`],["Accept-Ranges","bytes"],["Content-Length","2"],["Content-Type",s]]})}const u=`${n}?start=${c}&end=${l}`,[f,g]=await async function(t){const n=await self.caches.open(e);return Promise.all([n.match(`${t}&type=arrayBuffer`).then((e=>e?e.arrayBuffer():void 0)),n.match(`${t}&type=headers`).then((e=>e?e.json():void 0))])}(u);if(console.log(`FETCH PROGRESSIVE ${u} (request: ${c}-${d}) CACHED: ${Boolean(f)}`),f)return new Response(f,{status:206,statusText:"Partial Content",headers:g});let p;try{p=await async function(e,t){if(!e.clientId)return;const n=await self.clients.get(e.clientId);if(!n)return;const s=(e=>{let t;do{t=String(Math.random()).replace("0.","id")}while(e.hasOwnProperty(t));return t})(o),i={},r=Promise.race([a(6e4).then((()=>Promise.reject(new Error("ERROR_PART_TIMEOUT")))),new Promise(((e,t)=>{Object.assign(i,{resolve:e,reject:t})}))]);return o.set(s,i),r.catch((()=>{})).finally((()=>{o.delete(s)})),n.postMessage({type:"requestPart",messageId:s,params:t}),r}(t,{url:n,start:c,end:l})}catch(e){console.error("FETCH PROGRESSIVE",e)}if(!p)return new Response("",{status:500,statusText:"Failed to fetch progressive part"});const{arrayBuffer:w,fullSize:h,mimeType:m}=p,y=Math.min(l-c+1,w.byteLength);l=c+y-1;const v=w.slice(0,y),I=[["Content-Range",`bytes ${c}-${l}/${h}`],["Accept-Ranges","bytes"],["Content-Length",String(y)],["Content-Type",m]];return y<=524288&&l<2097151&&async function(t,n,s){const a=await self.caches.open(e);Promise.all([a.put(new Request(`${t}&type=arrayBuffer`),new Response(n)),a.put(new Request(`${t}&type=headers`),new Response(JSON.stringify(s)))])}(u,v,I),new Response(v,{status:206,statusText:"Partial Content",headers:I})}(t)),!0):!(!n.startsWith("http")||!n.match(y)||(t.respondWith(r(t)),0))})),self.addEventListener("push",(function(e){console.log("[SW] Push received event",e),e.data&&console.log("[SW] Push received with data",e.data.json());const t=function(e){try{return e.data.json()}catch(t){return void console.log("[SW] Unable to parse push notification data",e.data)}}(e);if(!t||t.mute===c.True)return;const n=function(e){return{chatId:f(e),messageId:g(e),title:e.title||"Telegram WebZ",body:e.description}}(t);l.has(n.messageId)?l.delete(n.messageId):e.waitUntil(h(n))})),self.addEventListener("notificationclick",(function(e){const t=self.registration.scope;e.notification.close();const{data:n}=e.notification;e.waitUntil((async()=>{const e=await p();if(await Promise.all(e.map((e=>(u[e.id]=n,m(e,n))))),self.clients.openWindow&&!(e.length>0)){u[0]=n;try{const e=await self.clients.openWindow(t);e&&(u[e.id]=n)}catch(e){console.warn("[SW] ",e)}}})())})),self.addEventListener("message",(function(e){if(!e.data)return;const t=e.source;if("clientReady"===e.data.type){const n=u[t.id]||u[0];n&&(delete u[t.id],delete u[0],e.waitUntil(m(t,n)))}if("newMessageNotification"===e.data.type){const t=e.data.payload;l.add(t.messageId),e.waitUntil(h(t))}"closeMessageNotifications"===e.data.type&&e.waitUntil(async function({chatId:e,lastReadInboxMessageId:t}){const n=await self.registration.getNotifications(),s=t||Number.MAX_VALUE;n.forEach((t=>{("0"===t.tag||t.data.chatId===e&&t.data.messageId<=s)&&t.close()}))}(e.data.payload))}))})();
//# sourceMappingURL=524.499b88c80f7b9a4a7715.js.map